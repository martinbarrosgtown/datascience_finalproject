---
title: "Remittances Data - Exploratory Data Analysis"
author: "Eva Langbehn" 
format: 
  html:
    toc: true
    toc-depth: 3
    code-fold: false
    theme: cosmo
editor: visual
---

# Setup and Data Loading

## Load Required Packages
```{r message=FALSE, warning=FALSE}
library(tidymodels)   
library(tidyverse)   
library(janitor)   
library(naniar)       
library(assertr)      
library(corrplot)
library(gridExtra)

## Turn off scientific notation for readable numbers
options(scipen = 999)
```

## Load the Data
```{r message=FALSE, warning=FALSE}
## Read in the CSV file
remittances <- read_csv("remittances.csv")
```

## Create Training and Testing Splits
```{r}
## Set seed for reproducibility
set.seed(20251211)

## Split data: 80% training, 20% testing
remit_split <- initial_split(data = remittances, prop = 0.8)
remit_train <- training(x = remit_split) 
remit_test <- testing(x = remit_split)
```


---

# STEP 1: Data Overview

## Get a Quick Look at the Data Structure
```{r}
## View the first few rows and column types
glimpse(remit_train)
```

The training data has **3,918 rows** and **19 columns**. We can see:

- Character columns: country_name, country_code
- Numeric columns: year, remittances, gdp, unemployment, etc.

## Calculate Summary Statistics
```{r}
## Get min, max, mean, median for all variables
summary(remit_train)
```

Key observations:

- Years range from 1994 to 2024 (30 years of data)
- Remittances range from $11,470 to $137.7 billion

## Check Internal Structure
```{r}
## Detailed structure of the data
str(remit_train)
```

All numeric variables are stored as `num` or `dbl` (double precision), and text variables are stored as `chr` (character). 

---

# STEP 2: Column Names and Types

## View Original Column Names
```{r}
## Check current column names
names(remit_train)
```

Some column names have spaces and capital letters.

## Clean Column Names to Snake Case
```{r}
## Convert to lowercase with underscores
remit_train <- remit_train |>
  clean_names()

## Verify the cleaned names
names(remit_train)
```

Now all column names are lowercase with underscores.


---

# STEP 3: Missing Data Analysis

## Count Missing Values by Column
```{r}
## Count NA values in each column
colSums(is.na(remit_train))
```

Several variables have missing data. Let's calculate the percentage!

## Calculate Percentage of Missing Data
```{r}
## Calculate percent missing for each variable
remit_train |>
  summarise(across(everything(), ~sum(is.na(.)) / n() * 100))
```

**Major findings:**

- **poverty**: 64.3% missing 
- **stock**: 49.8% missing
- **remittances**: 15.8% missing 
- **remittances_gdp**: 16.3% missing 


---

# STEP 4: Outlier Detection and Distribution Analysis

## Examine Remittances (Our Target Variable)

### Summary Statistics for Remittances
```{r}
## Get min, max, mean, median, quartiles
summary(remit_train$remittances)
```

The mean ($2.55 billion) is much larger than the median ($529 million). The data is **right-skewed**.

### Point Plot to See Distribution
```{r fig.width=10, fig.height=5}
## Create a point plot (from class notes Section 5.6.1)
remit_train |>
  ggplot(aes(remittances, 1)) +
  geom_point(alpha = 0.2) +
  scale_y_continuous(breaks = 0) +
  labs(y = NULL, title = "Distribution of Remittances") +
  theme_bw() +
  theme(panel.border = element_blank())
```

Most points cluster on the left (lower values) with a few extreme points on the right (confirms right-skewness).

### Histogram to See Frequency Distribution
```{r fig.width=10, fig.height=6}
## Create histogram with 30 bins
remit_train |>
  ggplot(aes(x = remittances)) +
  geom_histogram(bins = 30, fill = "steelblue") +
  theme_minimal() +
  labs(title = "Distribution of Remittances",
       x = "Remittances (USD)",
       y = "Count")
```

The histogram is heavily concentrated on the left with a long tail to the right. This is classic right-skewed data.

### Boxplot to Identify Outliers
```{r fig.width=10, fig.height=6}
## Create boxplot to see outliers
remit_train |>
  ggplot(aes(y = remittances)) +
  geom_boxplot(fill = "steelblue") +
  theme_minimal() +
  labs(title = "Boxplot of Remittances",
       y = "Remittances (USD)")
```

Many points appear above the upper whisker (outliers). These are likely large countries like Mexico that receive billions in remittances.

## Examine GDP

### Summary Statistics for GDP
```{r}
## Get summary statistics
summary(remit_train$gdp)
```

GDP also shows huge range - from $21 million to $18.7 trillion.

### Point Plot for GDP Distribution
```{r fig.width=10, fig.height=5}
## Create point plot for GDP
remit_train |>
  ggplot(aes(gdp, 1)) +
  geom_point(alpha = 0.2) +
  scale_y_continuous(breaks = 0) +
  labs(y = NULL, title = "Distribution of GDP") +
  theme_bw() +
  theme(panel.border = element_blank())
```

GDP shows the same right-skewed pattern as remittances. Large economies have much higher GDP than small economies.

## Examine Unemployment

### Summary Statistics for Unemployment
```{r}
## Get summary statistics
summary(remit_train$unemployment)
```

Unemployment ranges from 0.11% to 34.01%. 

### Point Plot for Unemployment Distribution
```{r fig.width=10, fig.height=5}
## Create point plot for unemployment
remit_train |>
  ggplot(aes(unemployment, 1)) +
  geom_point(alpha = 0.2) +
  scale_y_continuous(breaks = 0) +
  labs(y = NULL, title = "Distribution of Unemployment") +
  theme_bw() +
  theme(panel.border = element_blank())
```

Unemployment appears more evenly distributed than remittances or GDP. 

## Examine Inflation

### Summary Statistics for Inflation
```{r}
## Get summary statistics
summary(remit_train$inflation)
```

The maximum inflation is 6,041%! (outlier) Most inflation values are between 1.7% and 9%, 

### Point Plot for Inflation Distribution
```{r fig.width=10, fig.height=5}
## Create point plot for inflation
remit_train |>
  ggplot(aes(inflation, 1)) +
  geom_point(alpha = 0.2) +
  scale_y_continuous(breaks = 0) +
  labs(y = NULL, title = "Distribution of Inflation") +
  theme_bw() +
  theme(panel.border = element_blank())
```



## Data Quality Unit Tests

### Test 1: Are All Remittances Positive?
```{r}
## Test that remittances > 0 when not missing
remit_train |>
  filter(!is.na(remittances)) |>
  verify(remittances > 0) |>
  summarise(mean_remittances = mean(remittances, na.rm = TRUE))
```

All remittances are positive. The mean is $2.55 billion.

### Test 2: Are All Years in Valid Range?
```{r}
## Test that years are between 1994 and 2024
remit_train |>
  verify(year >= 1994 & year <= 2024) |>
  summarise(mean_year = mean(year))
```

All years are within the expected range. 

### Test 3: Are All Unemployment Values Valid?
```{r}
## Test that unemployment is between 0 and 100
remit_train |>
  filter(!is.na(unemployment)) |>
  verify(unemployment >= 0 & unemployment <= 100) |>
  summarise(mean_unemployment = mean(unemployment, na.rm = TRUE))
```

All unemployment values are valid percentages (0-100%). 

---

# STEP 4: Log Transformations for Skewed Variables

Since remittances and GDP are highly right-skewed, we need to create and examine log.

## Create Log-Transformed Variables
```{r}
## Create log-transformed versions of skewed variables
remit_train <- remit_train |>
  mutate(
    log_remittances = log(remittances + 1),
    log_gdp = log(gdp + 1)
  )
```

We add 1 before taking the log to handle any zero values (log(0) is undefined).

## Examine Log-Transformed Remittances

### Summary Statistics for Log Remittances
```{r}
## Get summary statistics for log remittances
summary(remit_train$log_remittances)
```

### Histogram of Log Remittances
```{r fig.width=10, fig.height=6}
## Create histogram for log-transformed remittances
remit_train |>
  filter(!is.na(log_remittances)) |>
  ggplot(aes(x = log_remittances)) +
  geom_histogram(bins = 30, fill = "darkgreen", color = "white") +
  theme_minimal() +
  labs(title = "Distribution of Log-Transformed Remittances",
       subtitle = "Much more normal distribution after log transformation",
       x = "Log(Remittances + 1)",
       y = "Count")
```

The log-transformed remittances show a much more normal distribution compared to the original right-skewed data.

### Boxplot of Log Remittances
```{r fig.width=10, fig.height=6}
## Create boxplot for log remittances
remit_train |>
  filter(!is.na(log_remittances)) |>
  ggplot(aes(y = log_remittances)) +
  geom_boxplot(fill = "darkgreen") +
  theme_minimal() +
  labs(title = "Boxplot of Log-Transformed Remittances",
       y = "Log(Remittances + 1)")
```

Fewer outliers visible after log transformation.

## Examine Log-Transformed GDP

### Summary Statistics for Log GDP
```{r}
## Get summary statistics for log GDP
summary(remit_train$log_gdp)
```

### Histogram of Log GDP
```{r fig.width=10, fig.height=6}
## Create histogram for log-transformed GDP
remit_train |>
  filter(!is.na(log_gdp)) |>
  ggplot(aes(x = log_gdp)) +
  geom_histogram(bins = 30, fill = "darkblue", color = "white") +
  theme_minimal() +
  labs(title = "Distribution of Log-Transformed GDP",
       subtitle = "More normal distribution after log transformation",
       x = "Log(GDP + 1)",
       y = "Count")
```

Log GDP also shows a more normal distribution.

## Compare Original vs Log-Transformed

### Side-by-Side: Original vs Log Remittances
```{r fig.width=12, fig.height=5}
## Create comparison plots
p1 <- remit_train |>
  filter(!is.na(remittances)) |>
  ggplot(aes(x = remittances)) +
  geom_histogram(bins = 30, fill = "steelblue") +
  theme_minimal() +
  labs(title = "Original Remittances (Right-Skewed)",
       x = "Remittances (USD)")

p2 <- remit_train |>
  filter(!is.na(log_remittances)) |>
  ggplot(aes(x = log_remittances)) +
  geom_histogram(bins = 30, fill = "darkgreen") +
  theme_minimal() +
  labs(title = "Log-Transformed Remittances (More Normal)",
       x = "Log(Remittances + 1)")

grid.arrange(p1, p2, ncol = 2)
```

The log transformation successfully converts the right-skewed distribution into a more normal distribution, which is better for modeling.

### Side-by-Side: Original vs Log GDP
```{r fig.width=12, fig.height=5}
## Create comparison plots for GDP
p3 <- remit_train |>
  filter(!is.na(gdp)) |>
  ggplot(aes(x = gdp)) +
  geom_histogram(bins = 30, fill = "steelblue") +
  theme_minimal() +
  labs(title = "Original GDP (Right-Skewed)",
       x = "GDP (USD)")

p4 <- remit_train |>
  filter(!is.na(log_gdp)) |>
  ggplot(aes(x = log_gdp)) +
  geom_histogram(bins = 30, fill = "darkblue") +
  theme_minimal() +
  labs(title = "Log-Transformed GDP (More Normal)",
       x = "Log(GDP + 1)")

grid.arrange(p3, p4, ncol = 2)
```

## Relationship: Log GDP vs Log Remittances
```{r fig.width=10, fig.height=6}
## Scatter plot with log-transformed variables
remit_train |>
  filter(!is.na(log_gdp), !is.na(log_remittances)) |>
  ggplot(aes(x = log_gdp, y = log_remittances)) +
  geom_point(alpha = 0.3, color = "steelblue") +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  theme_minimal() +
  labs(title = "Log GDP vs Log Remittances",
       subtitle = "Clearer linear relationship after log transformation",
       x = "Log(GDP + 1)",
       y = "Log(Remittances + 1)")
```

The relationship between log GDP and log remittances is **more linear** than the original variables, which will improve model performance.

---

# STEP 5: Categorical Variables Analysis

## Count Unique Countries
```{r}
## Count distinct country names
n_distinct(remit_train$country_name)
```

We have 158 different countries in the dataset.

## View Frequency Table (First 20 Countries)
```{r}
## Show how many observations per country
head(table(remit_train$country_name), 20)
```

Most countries have between 20-30 observations, representing roughly 20-30 years of data.

## Create Bar Chart of Top 20 Countries
```{r fig.width=10, fig.height=8}
## Count observations per country and plot top 20
remit_train |>
  count(country_name, sort = TRUE) |>
  slice_head(n = 20) |>
  ggplot(aes(x = reorder(country_name, n), y = n)) +
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() +
  theme_minimal() +
  labs(title = "Top 20 Countries by Number of Observations",
       x = "Country",
       y = "Count")
```

Countries are fairly evenly represented. Bahrain has the most observations (30), while several countries have around 20-29 observations. 

---

# STEP 6: Relationships Between Variables

## GDP vs Remittances (Original Scale)
```{r fig.width=10, fig.height=6}
## Scatter plot with trend line
remit_train |>
  ggplot(aes(x = gdp, y = remittances)) +
  geom_point(alpha = 0.3, color = "steelblue") +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  theme_minimal() +
  labs(title = "Relationship Between GDP and Remittances (Original Scale)",
       x = "GDP (USD)",
       y = "Remittances (USD)")
```

There is a clear positive relationship. Countries with larger economies (higher GDP) tend to receive more remittances in absolute dollar amounts. The red line shows the linear trend.

## Log GDP vs Log Remittances (Better for Modeling)
```{r fig.width=10, fig.height=6}
## Scatter plot with log-transformed variables
remit_train |>
  filter(!is.na(log_gdp), !is.na(log_remittances)) |>
  ggplot(aes(x = log_gdp, y = log_remittances)) +
  geom_point(alpha = 0.3, color = "darkgreen") +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  theme_minimal() +
  labs(title = "Log GDP vs Log Remittances (Log Scale - Better Linear Fit)",
       subtitle = "This relationship is more appropriate for linear regression models",
       x = "Log(GDP + 1)",
       y = "Log(Remittances + 1)")
```

The log-transformed relationship is **more linear** and will produce better model predictions.

## GDP Per Capita vs Remittances as % of GDP
```{r fig.width=10, fig.height=6}
## Scatter plot with trend line
remit_train |>
  ggplot(aes(x = gdp_per, y = remittances_gdp)) +
  geom_point(alpha = 0.3, color = "steelblue") +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  theme_minimal() +
  labs(title = "GDP Per Capita vs Remittances as % of GDP",
       x = "GDP Per Capita (USD)",
       y = "Remittances as % of GDP")
```

Poorer countries (lower GDP per capita) depend more heavily on remittances as a percentage of their economy. Richer countries receive remittances but they represent a smaller share of their total GDP.

## Unemployment vs Remittances
```{r fig.width=10, fig.height=6}
## Scatter plot with trend line
remit_train |>
  ggplot(aes(x = unemployment, y = remittances)) +
  geom_point(alpha = 0.3, color = "steelblue") +
  geom_smooth(method = "lm", se = TRUE, color = "red") +
  theme_minimal() +
  labs(title = "Unemployment vs Remittances",
       x = "Unemployment Rate (%)",
       y = "Remittances (USD)")
```

There is a **slight negative relationship** (it is weak). Unemployment doesn't appear to be a strong predictor of remittances.

## Correlation Matrix (Numbers)
```{r}
## Calculate correlations between all numeric variables
remit_train |>
  select(where(is.numeric)) |>
  cor(use = "complete.obs") |>
  round(2)
```


- **gdp and remittances: 0.46** - Moderate positive (as GDP increases, remittances increase)
- **log_gdp and log_remittances: Check the correlation matrix** - Likely stronger correlation
- **stock and deportations: 0.73** - Strong positive (might cause multicollinearity issues)
- **dist_pop and dist_cap: 1.00** - Perfect correlation! These measure essentially the same thing. **We must drop one.**
- **internet and year: 0.69** - Strong positive (internet access increases over time)
- **gdp_per and vulnerable_emp: -0.63** - Strong negative (richer countries have less vulnerable employment)

## Correlation Matrix (Heatmap)
```{r fig.width=12, fig.height=10}
## Create visual correlation matrix
remit_train |>
  select(where(is.numeric)) |>
  cor(use = "complete.obs") |>
  corrplot(method = "color", 
           type = "upper",
           tl.col = "black",
           tl.srt = 45,
           title = "Correlation Matrix",
           mar = c(0,0,2,0))
```


- **Blue squares** = positive correlation (variables increase together)
- **Red squares** = negative correlation (one increases, other decreases)
- **Darker colors** = stronger correlation



---

# STEP 7: Time Trends Analysis

## Remittances Over Time
```{r fig.width=12, fig.height=6}
## Calculate average remittances per year and plot
remit_train |>
  group_by(year) |>
  summarise(avg_remittances = mean(remittances, na.rm = TRUE)) |>
  ggplot(aes(x = year, y = avg_remittances)) +
  geom_line(color = "steelblue", linewidth = 1) +
  geom_point(color = "steelblue") +
  theme_minimal() +
  labs(title = "Average Remittances Over Time (1994-2024)",
       x = "Year",
       y = "Average Remittances (USD)")
```

Remittances show a clear upward trend over 30 years. We can see:

- Steady growth from 1994 to 2008.
- A dip around 2008-2009 (global financial crisis).
- Recovery and continued growth.
- Another dip around 2020 (COVID-19 pandemic).
- Strong rebound after 2020.

## Remittances as % of GDP Over Time
```{r fig.width=12, fig.height=6}
## Calculate average remittances as % of GDP per year and plot
remit_train |>
  group_by(year) |>
  summarise(avg_remittances_gdp = mean(remittances_gdp, na.rm = TRUE)) |>
  ggplot(aes(x = year, y = avg_remittances_gdp)) +
  geom_line(color = "steelblue", linewidth = 1) +
  geom_point(color = "steelblue") +
  theme_minimal() +
  labs(title = "Average Remittances as % of GDP Over Time",
       x = "Year",
       y = "Remittances as % of GDP")
```

Remittances as a percentage of GDP have stayed relatively **stable around 3-4%** over time. This means remittances are growing roughly in line with GDP growth, not becoming more or less important to economies over time.

---
